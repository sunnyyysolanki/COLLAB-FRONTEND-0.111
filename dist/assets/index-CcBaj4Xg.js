const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Collaborators-BWuwidvj.js","assets/react-kDj6t8jd.js","assets/classnames-ELZfJkp_.js","assets/prop-types-D5nIUkaZ.js","assets/react-bootstrap-CdsT1MgL.js","assets/@restart-tvjSGzj1.js","assets/dom-helpers-BsN-Z0DW.js","assets/react-dom-DN4igg0M.js","assets/scheduler-BNqrtbQi.js","assets/react-transition-group-DcErqrXj.js","assets/@babel-G6YR9G09.js","assets/react-router-1WkuugLQ.js","assets/cookie--_YQFYBD.js","assets/Add_Collaborators-7x7ZZwVy.js","assets/@tanstack-g5oh4P0D.js","assets/axios-DW_MHI2K.js","assets/react-redux-DpWfQt2x.js","assets/use-sync-external-store-DV0KjrHr.js","assets/@reduxjs-zIbhoCio.js","assets/redux-BXkGT1VS.js","assets/immer-DqxjFn0G.js","assets/redux-thunk-ClJT1hhx.js","assets/react-toastify-Y4N22MFQ.js","assets/clsx-B-dksMZM.js","assets/react-toastify-GNLSjkBZ.css","assets/jwt-decode-VWaDGczM.js","assets/socket.io-client-CDVIIGn8.js","assets/engine.io-client-C44f3zIw.js","assets/engine.io-parser-BiEtp6m2.js","assets/@socket.io-Dkula2eQ.js","assets/socket.io-parser-BBkuslX-.js","assets/markdown-to-jsx-BQQhr_-U.js","assets/@webcontainer-6WLe8uJq.js","assets/highlight.js-DQnaPH0Z.js","assets/highlight-BEHUn5zE.css","assets/lucide-react-CxBdCssK.js","assets/bootstrap-tK7EUtyc.css"])))=>i.map(i=>d[i]);
import{j as e,r as u}from"./react-kDj6t8jd.js";import{c as me}from"./react-dom-DN4igg0M.js";import{O as se,u as q,L as F,a as oe,b as K,c as ge,R as he}from"./react-router-1WkuugLQ.js";import{a as v}from"./axios-DW_MHI2K.js";import{u as G,a as J,P as fe}from"./react-redux-DpWfQt2x.js";import{c as pe,a as xe,b as ye}from"./@reduxjs-zIbhoCio.js";import{y as W,L as be}from"./react-toastify-Y4N22MFQ.js";import{j as je}from"./jwt-decode-VWaDGczM.js";import{B as H,M as _,F as z}from"./react-bootstrap-CdsT1MgL.js";import{u as $,a as ne,Q as we,b as ve}from"./@tanstack-g5oh4P0D.js";/* empty css                  */import{p as b}from"./prop-types-D5nIUkaZ.js";import{l as Ne}from"./socket.io-client-CDVIIGn8.js";import{M as Se}from"./markdown-to-jsx-BQQhr_-U.js";import{W as ke}from"./@webcontainer-6WLe8uJq.js";import{H as ee}from"./highlight.js-DQnaPH0Z.js";import{P as Ce,T as Pe,a as Ee,X as Le,b as Re}from"./lucide-react-CxBdCssK.js";import"./classnames-ELZfJkp_.js";import"./scheduler-BNqrtbQi.js";import"./cookie--_YQFYBD.js";import"./use-sync-external-store-DV0KjrHr.js";import"./redux-BXkGT1VS.js";import"./immer-DqxjFn0G.js";import"./redux-thunk-ClJT1hhx.js";import"./clsx-B-dksMZM.js";import"./@restart-tvjSGzj1.js";import"./dom-helpers-BsN-Z0DW.js";import"./react-transition-group-DcErqrXj.js";import"./@babel-G6YR9G09.js";import"./engine.io-client-C44f3zIw.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function Ie(){return e.jsx(e.Fragment,{children:e.jsx(se,{})})}const ae=v.create({baseURL:"http://localhost:3000",headers:{authorization:`Bearer ${localStorage.getItem("token")}`}}),B=pe("fetch_user",async(t,{rejectWithValue:s})=>{var n;try{return(await v.get("http://localhost:3000/profile",{headers:{Authorization:`Bearer ${t}`}})).data}catch(a){return s(((n=a.response)==null?void 0:n.data)||"An error occurred")}}),le=xe({name:"user",initialState:{user:null,isLoading:!1,error:null,isAuth:!1},extraReducers:t=>{t.addCase(B.pending,s=>{s.isLoading=!0,s.error=null}).addCase(B.fulfilled,(s,n)=>{s.isLoading=!1,s.user=n.payload,s.isAuth=!0}).addCase(B.rejected,(s,n)=>{s.isLoading=!1,s.error=n.payload.message||"Failed to fetch user",s.user=null,s.isAuth=!1})},reducers:{logout:t=>{localStorage.removeItem("token"),t.user=null,t.isAuth=!1,t.isLoading=!1,t.error=null}}}),{logout:ie}=le.actions;function X(t){W.success(t,{position:"top-right"})}function C(t){W.error(t,{position:"top-right"})}function Ae(t){try{if(!t)return!0;const s=je(t),n=Date.now()/1e3;return s.exp<n?(W.error("Token has expired",{position:"top-right"}),!0):!1}catch{return W.error("Invalid token",{position:"top-right"}),!0}}const te=()=>{const[t,s]=u.useState(""),[n,a]=u.useState("");G();const o=q();u.useEffect(()=>{localStorage.getItem("token")&&o("/home")},[o]);const i=async l=>{var g,d;if(l.preventDefault(),!t||!n){C("Please fill in all fields");return}try{const h=await ae.post("user/login",{email:t,password:n});h.data.success&&(localStorage.setItem("token",h.data.token),X("successfull"),o("/home"))}catch(h){C((d=(g=h.response)==null?void 0:g.data)==null?void 0:d.message)}};return e.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-gray-900 px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-wider text-center text-white mb-8",children:"COLLABORATIVE CODING"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("div",{className:"w-full max-w-lg p-10 space-y-8 bg-gray-800 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-white",children:"Login"}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:i,children:[e.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"relative block w-full px-4 py-3 rounded-t-md border-b-4 border-gray-800 focus:outline-none focus:ring-border-gray-800 focus:border-border-gray-800 focus:z-40 font-stretch-100% sm:text-sm bg-gray-700 text-white",placeholder:"Email address",value:t,onChange:l=>s(l.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"relative block w-full px-4 py-3 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-40 sm:text-sm bg-gray-700 text-white",placeholder:"Password",value:n,onChange:l=>a(l.target.value)})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"relative flex justify-center w-full px-4 py-3 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md group hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Sign in"})})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-400",children:["Don't have an account?"," ",e.jsx(F,{to:"/signup",className:"font-medium text-indigo-400 hover:text-indigo-300",children:"Sign up"})]})})]})})]})},_e=()=>{const[t,s]=u.useState(""),[n,a]=u.useState(""),[o,i]=u.useState(""),l=q(),g=async d=>{if(d.preventDefault(),!t||!n||!o){C("Please fill in all fields");return}try{(await ae.post("user/signup",{name:t,email:n,password:o})).data.success&&(X("Signup Successfull"),l("/login"))}catch(h){C(h.response.data.message)}};return e.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-gray-900 px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-wider text-center text-white mb-8",children:"COLLABORATIVE CODING"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("div",{className:"w-full max-w-lg p-10 space-y-8 bg-gray-800 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-white",children:"Sign Up"}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:g,children:[e.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"sr-only",children:"Name"}),e.jsx("input",{id:"name",name:"name",type:"text",autoComplete:"name",required:!0,className:"relative block w-full px-4 py-3 rounded-t-md border-b-4 border-gray-800 focus:outline-none focus:ring-border-gray-800 focus:border-border-gray-800 focus:z-40 font-stretch-100% sm:text-sm bg-gray-700 text-white",placeholder:"Name",value:t,onChange:d=>s(d.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"relative block w-full px-4 py-3 border-b-4 border-gray-800 focus:outline-none focus:ring-border-gray-800 focus:border-border-gray-800 focus:z-40 font-stretch-100% sm:text-sm bg-gray-700 text-white",placeholder:"Email address",value:n,onChange:d=>a(d.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"relative block w-full px-4 py-3 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-40 sm:text-sm bg-gray-700 text-white",placeholder:"Password",value:o,onChange:d=>i(d.target.value)})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"relative flex justify-center w-full px-4 py-3 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md group hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Sign up"})})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-400",children:["Already have an account?"," ",e.jsx(F,{to:"/login",className:"font-medium text-indigo-400 hover:text-indigo-300",children:"Sign in"})]})})]})})]})};function qe(){const t=$(),[s,n]=u.useState(!1),a=()=>{l(""),n(!1)},o=()=>n(!0),[i,l]=u.useState("");async function g(d){var h,j;if(d.preventDefault(),i.length===0){C("Project Name Cannont be Empty");return}try{(await v.post("http://localhost:3000/project",{project_name:i},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data.success&&(X("Project Created Successfully"),t.invalidateQueries({queryKey:["projects"]}),a())}catch(p){C((j=(h=p.response)==null?void 0:h.data)==null?void 0:j.message)}}return e.jsxs(e.Fragment,{children:[e.jsx(H,{onClick:o,className:"bg-blue-600 text-white px-4 py-2 rounded-lg  shadow-gray-400 hover:shadow-xl  hover:scale-115",children:"Create a New Project"}),e.jsxs(_,{show:s,onHide:a,centered:!0,backdrop:"static",keyboard:!1,children:[e.jsx(_.Header,{closeButton:!0,children:e.jsx(_.Title,{children:"Project Name"})}),e.jsx(_.Body,{children:e.jsxs(z,{onSubmit:g,children:[e.jsxs(z.Group,{className:"mb-3",controlId:"exampleForm.ControlInput1",children:[e.jsx(z.Label,{}),e.jsx(z.Control,{value:i,onChange:d=>l(d.target.value),type:"text",placeholder:"Project Name",autoFocus:!0})]}),e.jsxs(_.Footer,{children:[e.jsx(H,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(H,{variant:"primary",type:"submit",children:"Create"})]})]})})]})]})}const $e=()=>{$();const{isPending:t,error:s,data:n}=ne({queryKey:["projects"],queryFn:async()=>{try{return(await v.get("http://localhost:3000/project",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data.projects}catch(a){console.log(a)}}});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center items-center mt-16",children:e.jsx(qe,{})}),e.jsx("div",{className:"flex flex-wrap justify-center mx-24 gap-x-12 gap-y-12 mt-16 bg-gray-200 py-8",children:n==null?void 0:n.map(a=>e.jsxs(F,{to:`/project/${a._id}`,state:a,className:"bg-gray-300 text-black !no-underline flex flex-col cursor-pointer hover:shadow-2xl items-center min-w-76 h-32 justify-center rounded-lg hover:scale-115",children:[e.jsxs("div",{className:"flex flex-wrap px-4 gap-2 items-center",children:[e.jsx("p",{className:"",children:"Project:"}),e.jsx("p",{className:"font-bold text-xl ",children:a.name.length>15?`${a.name.slice(0,19)}...`:a.name})]}),e.jsx("p",{className:"text-lg",children:a.user.length})]},a._id))})]})},Oe=ye({reducer:{user:le.reducer}}),Te=()=>{const{data:t,isLoading:s}=J(d=>d.user),n=q(),a=G(),o=$(),l=oe().state,g=()=>{a(ie()),o.clear(),n("/login")};return s?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"bg-gray-900 p-4  flex justify-between items-center",children:[e.jsx("p",{className:"text-3xl text-white m-0 p-0 font-bold",children:"COLLABORATIVE CODING ðŸš€"}),(l==null?void 0:l.name)&&e.jsx("p",{className:"text-5xl font-bold p-0 m-0 text-purple-500",children:l==null?void 0:l.name}),e.jsx("button",{onClick:g,className:"bg-red-500 items-end text-white py-2 px-4 rounded-lg hover:bg-red-700",children:"Logout"})]})},ze=()=>{const t=q(),s=G(),n=oe(),{isAuth:a,isLoading:o,user:i,error:l}=J(g=>g.user);return u.useEffect(()=>{const g=localStorage.getItem("token");if(!g){t("/login");return}if(Ae(g)){C("Token has expired"),s(ie()),t("/login");return}!a&&!i&&s(B(g))},[a,s,t,i,n]),o?e.jsx("div",{children:"Loading..."}):a?e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx(se,{})]}):null},Be="modulepreload",We=function(t){return"/"+t},re={},Y=function(s,n,a){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),g=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=Promise.allSettled(n.map(d=>{if(d=We(d),d in re)return;re[d]=!0;const h=d.endsWith(".css"),j=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${j}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":Be,h||(p.as="script"),p.crossOrigin="",p.href=d,g&&p.setAttribute("nonce",g),document.head.appendChild(p),h)return new Promise((N,S)=>{p.addEventListener("load",N),p.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(l){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=l,window.dispatchEvent(g),!g.defaultPrevented)throw l}return o.then(l=>{for(const g of l||[])g.status==="rejected"&&i(g.reason);return s().catch(i)})};let x=null;function ce(t){return x&&x.connected||(console.log("ðŸ”„ Initializing WebSocket..."),x=Ne("http://localhost:3000",{auth:{token:localStorage.getItem("token")},query:{project_id:t},reconnection:!0,reconnectionAttempts:5,reconnectionDelay:2e3}),x.on("connect",()=>{console.log("âœ… Connected to WebSocket")}),x.on("disconnect",()=>{console.warn("âš ï¸ Disconnected from WebSocket")})),x}const E=(t,s)=>{if(!x){console.error("Socket not initialized");return}x.emit(t,s)},L=(t,s)=>{if(!x){console.error("Socket not initialized");return}x.off(t),x.on(t,s)},De=()=>{x&&(x.disconnect(),x=null)};let P=null,V=!1;const Me=async()=>{if(P)return console.log("âš¡ WebContainer already initialized, returning existing instance."),P;if(V){for(console.log("â³ WebContainer initialization is in progress...");!P;)await new Promise(t=>setTimeout(t,100));return P}try{V=!0,P=await ke.boot(),console.log("âœ… WebContainer successfully booted.")}catch(t){throw console.error("âŒ WebContainer initialization error:",t),t}finally{V=!1}return P},Ue=u.lazy(()=>Y(()=>Promise.resolve().then(()=>Ve),void 0)),Qe=u.lazy(()=>Y(()=>import("./Collaborators-BWuwidvj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),He=u.lazy(()=>Y(()=>import("./Add_Collaborators-7x7ZZwVy.js"),__vite__mapDeps([13,1,2,4,5,6,7,8,3,9,10,14,11,12,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]))),de=({project:t,users:s})=>{const n=$(),[a,o]=u.useState(""),[i,l]=u.useState(t.messages),g=u.useRef(null),[d,h]=u.useState(null),[j,p]=u.useState([]),[N,S]=u.useState(t.fileTree||{}),[k,R]=u.useState(null),{user:y}=J(r=>r.user),{id:w}=K(),[D,M]=u.useState(null);u.useEffect(()=>{n.invalidateQueries({queryKey:["project"]}),h(null),p([]),S(t.fileTree||{}),l(t.messages)},[w,t,n,y]),u.useEffect(()=>{const r=ce(w);return M(r),r.on("connect",()=>console.log("âœ… Connected to WebSocket")),L("project-message",m=>{l(f=>[...f,m]),I()}),()=>{r.off("project-message"),De()}},[w]),u.useEffect(()=>{Me().then(r=>{R(r),console.log("âœ… WebContainer booted.")})},[w]),u.useEffect(()=>{var m;const r=i[i.length-1];if(((m=r==null?void 0:r.sender)==null?void 0:m.email)==="gemini@ai.com")try{const f=JSON.parse(r.message);f!=null&&f.fileTree&&k&&(k.mount(f.fileTree),S(T=>{const A={...T,...f.fileTree};return O(A),A}))}catch(f){console.error("âŒ Error parsing AI message:",f)}},[i,k,w]);async function U(r){try{await v.put("http://localhost:3000/project/chat-message",r,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})}catch(m){console.error("âŒ Error storing message:",m)}}async function Q(){if(!a.trim())return;const r={project_id:w,sender:{email:y==null?void 0:y.email},message:a};E("project-message",r),l(m=>[...m,r]),o(""),I(),await U(r)}async function O(r){try{await v.put("http://localhost:3000/project/file-tree",{project_id:w,fileTree:r},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})}catch(m){console.error(m)}}function I(){setTimeout(()=>{var r;(r=g.current)==null||r.scrollIntoView({behavior:"smooth"})},100)}function c(r){const m=JSON.parse(r);return e.jsx("div",{className:"break-words w-full text-lg whitespace-pre-wrap bg-gray-800 text-white rounded-md p-4",children:e.jsx(Se,{children:m.text})})}return e.jsxs("div",{className:"flex h-[calc(100vh-85px)] bg-gray-900 text-white",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-700 flex flex-col h-full bg-gray-800 shadow-lg rounded-lg",children:[e.jsxs("div",{className:"top w-full h-14 bg-blue-600 text-white font-semibold px-3 flex justify-between items-center rounded-t-lg",children:[e.jsx(He,{users:s,project:t}),e.jsx(Qe,{users:t==null?void 0:t.user})]}),e.jsxs("div",{className:"message-box flex-1 overflow-y-auto p-4 space-y-3",children:[i.map((r,m)=>{var f,T,A,Z;return e.jsx("div",{className:`flex flex-col max-w-full ${((f=r.sender)==null?void 0:f.email)===(y==null?void 0:y.email)?"self-end items-end":"self-start items-start"}`,children:e.jsxs("div",{className:`px-3 py-2 rounded-xl max-w-[80%] shadow-md ${((T=r.sender)==null?void 0:T.email)===(y==null?void 0:y.email)?"bg-blue-500 text-white rounded-tr-none":"bg-gray-700 text-gray-200 rounded-tl-none"}`,children:[e.jsx("p",{className:"text-xs text-white",children:(A=r.sender)==null?void 0:A.email}),((Z=r.sender)==null?void 0:Z.email)==="gemini@ai.com"?c(r.message):e.jsx("p",{className:"break-words w-full font-bold text-lg",children:r.message})]})},m)}),e.jsx("div",{ref:g})]}),e.jsxs("div",{className:"bottom h-16 w-full bg-gray-700 flex items-center px-2 gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:r=>o(r.target.value),className:"flex-1 p-3 bg-gray-800 text-white rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter message..."}),e.jsx("button",{onClick:Q,className:"h-12 w-12 flex items-center justify-center bg-blue-600 rounded-full hover:bg-blue-500 transition",children:"ðŸš€"})]})]}),e.jsx(u.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(Ue,{fileTree:N,currentFile:d,setCurrentFile:h,setFileTree:S,openFiles:j,setOpenFiles:p,webContainer:k,socket:D,saveFileTree:O})}),";"]})};de.propTypes={project:b.object.isRequired,users:b.array.isRequired};const ue=({currentFile:t,setCurrentFile:s,fileTree:n,setFileTree:a,openFiles:o,setOpenFiles:i,webContainer:l,socket:g,saveFileTree:d})=>{var I;const h=u.useRef(null),[j,p]=u.useState(null),[N,S]=u.useState(null),[k,R]=u.useState(!1),y=K().id,[w,D]=u.useState(null);u.useEffect(()=>{const c=ce(y);D(c),c.on("connect",()=>console.log("âœ… Connected to WebSocket")),L("project-code",r=>{var f;a(r);const m=((f=r[t])==null?void 0:f.file.contents)||"";h.current&&(h.current.innerHTML=ee.highlightAuto(m).value)}),L("project-rename",r=>{console.log("rename"),a(r)}),L("project-delete",r=>{console.log("delte"),a(r)}),L("project-newfile",r=>{console.log("newfile"),a(r)}),L("project-running",r=>{R(r)})},[y,a,t]);const M=()=>{const c=`newFile${Object.keys(n).length+1}.js`,r={...n,[c]:{file:{contents:""}}};a(r),i([...o,c]),s(c),d(r),E("project-newfile",r)},U=c=>{const r={...n};delete r[c],a(r),i(o.filter(m=>m!==c)),t===c&&s(o.length>1?o[0]:null),d(r),E("project-delete",r)},Q=c=>{const r=prompt("Enter new file name:",c);if(r&&r!==c){const m={...n,[r]:n[c]};delete m[c],a(m),i(o.map(f=>f===c?r:f)),t===c&&s(r),d(m),E("project-rename",m)}},O=async()=>{if(k)await N.kill(),R(!1);else{await l.mount(n),await l.spawn("npm",["install"]),N&&await N.kill();const c=await l.spawn("npm",["start"]);S(c),l.on("server-ready",(r,m)=>{p(m),E("project-running",!0)}),R(!0)}};return e.jsxs("div",{className:"flex h-[calc(100vh-88px)] w-full bg-gray-950 text-white",children:[e.jsxs("div",{className:"w-64 p-4 bg-gray-900 shadow-lg rounded-lg overflow-auto scrollbar-thin scrollbar-thumb-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-purple-400",children:"Files"}),Object.keys(n).map((c,r)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>{s(c),o.includes(c)||i([...o,c])},className:`block flex-1 px-2 py-2 mb-2 rounded-lg text-left transition-all ${t===c?"bg-purple-600 text-white":"bg-gray-800 hover:bg-gray-700"}`,children:e.jsx("p",{className:"m-0 max-w-28 overflow-scroll",children:c})}),e.jsx(Ce,{className:"text-blue-400 hover:text-blue-600 cursor-pointer ml-2",onClick:()=>Q(c)}),e.jsx(Pe,{className:"text-red-400 hover:text-red-600 cursor-pointer ml-2",onClick:()=>U(c)})]},r)),e.jsxs("button",{className:"w-full flex items-center justify-center px-4 py-2 mt-4 bg-blue-500 rounded-lg hover:bg-blue-600 transition-all",onClick:M,children:[e.jsx(Ee,{className:"mr-2"})," New File"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 p-4 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 bg-gray-800 p-3 rounded-lg",children:[e.jsx("div",{className:"flex space-x-2 overflow-auto scrollbar-thin scrollbar-thumb-gray-700",children:o.map((c,r)=>e.jsxs("div",{className:`flex items-center px-4 py-2 rounded-md cursor-pointer transition-all ${t===c?"bg-purple-500":"bg-gray-700 hover:bg-gray-600"}`,onClick:()=>s(c),children:[e.jsx("span",{className:"mr-2 truncate max-w-[150px]",children:c}),e.jsx(Le,{className:"text-red-400 hover:text-red-600 cursor-pointer",onClick:m=>{m.stopPropagation(),i(o.filter(f=>f!==c)),t===c&&s(o.length>1?o[0]:null)}})]},r))}),e.jsxs("button",{className:"flex items-center bg-red-500 px-4 py-2 rounded-lg hover:bg-red-600 transition-all",onClick:O,children:[e.jsx(Re,{className:"mr-2"})," ",k?"STOP":"RUN"]})]}),e.jsx("div",{className:"bg-gray-950 flex-1 overflow-auto p-4 rounded-lg text-2xl",children:t?e.jsx("pre",{className:"hljs h-full",children:e.jsx("code",{ref:h,className:"hljs outline-none p-4",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:c=>{const r=c.target.innerText,m={...n,[t]:{file:{contents:r}}};a(m),d(m),E("project-code",m)},dangerouslySetInnerHTML:{__html:ee.highlightAuto(((I=n[t])==null?void 0:I.file.contents)||"").value}})}):e.jsx("p",{className:"text-gray-500 text-lg",children:"Select a file to edit"})}),j&&e.jsxs("div",{className:"h-[40%] mt-4 border-2 border-gray-700 rounded-lg overflow-hidden bg-gray-900 shadow-lg",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-800",children:e.jsx("input",{type:"text",value:j||"",onChange:c=>p(c.target.value),placeholder:"Enter a URL...",className:"w-full px-3 py-2 text-white bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})}),e.jsx("iframe",{src:j,title:"Project Preview",className:"w-full h-full rounded-b-lg border-none bg-gray-200"})]})]})]})};ue.propTypes={currentFile:b.string,setCurrentFile:b.func.isRequired,fileTree:b.objectOf(b.object).isRequired,setFileTree:b.func.isRequired,openFiles:b.array.isRequired,setOpenFiles:b.func.isRequired,webContainer:b.object.isRequired,saveFileTree:b.func.isRequired,socket:b.object};const Ve=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"})),Fe=()=>e.jsxs("div",{className:"h-screen flex flex-col items-center justify-center bg-gray-900 px-4 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-6xl font-bold tracking-wider text-white mb-8",children:"404"}),e.jsx("p",{className:"text-2xl text-center text-white",children:"Page not found. Please check the URL and try again."})]}),Ke=()=>{const t=K().id,s=$(),n=q(),[a,o]=u.useState([]);u.useEffect(()=>{s.invalidateQueries({queryKey:["projects"]});async function d(){try{const h=await v.get("http://localhost:3000/user",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!h.data.success)throw new Error("Failed to fetch users");o(h.data.users)}catch(h){console.log(h)}}d()},[s,t]);const{data:i,error:l,isLoading:g}=ne({queryKey:["project"],queryFn:async()=>{try{return(await v.get(`http://localhost:3000/project/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data.project}catch(d){console.log(d)}},staleTime:5*60*1e3});if(g)return e.jsx("div",{children:"Loading"});if(l){n("/404");return}return e.jsx(e.Fragment,{children:e.jsx(de,{project:i,users:a})})},Ge=new we,Je=ge([{element:e.jsx(Ie,{}),children:[{path:"/",element:e.jsx(te,{})},{path:"/login",element:e.jsx(te,{})},{path:"/signup",element:e.jsx(_e,{})}]},{element:e.jsx(ze,{}),children:[{path:"/home",element:e.jsx($e,{})},{path:"/project/:id",element:e.jsx(Ke,{})}]},{path:"/404",element:e.jsx(Fe,{})}]);me.createRoot(document.getElementById("root")).render(e.jsxs(u.StrictMode,{children:[e.jsx(be,{}),e.jsx(fe,{store:Oe,children:e.jsx(ve,{client:Ge,children:e.jsx(he,{router:Je})})})]}));export{X as a,ae as b,C as h};
